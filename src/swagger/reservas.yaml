paths:
  /api/v1/reservas:
    get:
      summary: Listado de reservas
      description: Devuelve todas las reservas activas con los servicios asociados. Requiere rol 1, 2 o 3.
      tags: [reservas]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Reservas obtenidas correctamente
          content:
            application/json:
              schema:
                type: object
                properties:
                  estado:
                    type: boolean
                  datos:
                    type: array
                    items:
                      $ref: '#/components/schemas/ReservaConServicios'
              example:
                estado: true
                datos:
                  - reserva_id: 12
                    fecha_reserva: "2025-01-15"
                    tematica: "Fútbol"
                    importe_total: 75000
                    salon_id: 2
                    salon_titulo: "Salón Principal"
                    hora_desde: "14:00:00"
                    hora_hasta: "18:00:00"
                    servicios:
                      - servicio_id: 3
                        descripcion: "Animación"
                        importe: 25000
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos para listar reservas
        '500':
          description: Error interno del servidor
    post:
      summary: Crear reserva
      description: Disponible para roles 1 (administrador) y 3 (cliente). Valida obligatoriedad de fecha, salón, cliente, turno y servicios.
      tags: [reservas]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReservaCreate'
            example:
              fecha_reserva: "2025-01-15"
              salon_id: 2
              usuario_id: 7
              turno_id: 1
              tematica: "Mario Bros"
              importe_salon: 60000
              importe_total: 85000
              servicios:
                - servicio_id: 1
                  importe: 15000
                - servicio_id: 4
                  importe: 10000
      responses:
        '200':
          description: Reserva creada y devuelta con sus servicios
          content:
            application/json:
              schema:
                type: object
                properties:
                  estado:
                    type: boolean
                  mensaje:
                    type: string
                  reserva:
                    $ref: '#/components/schemas/ReservaConServicios'
              example:
                estado: true
                mensaje: "Reserva creada!"
                reserva:
                  reserva_id: 18
                  fecha_reserva: "2025-01-15"
                  tematica: "Mario Bros"
                  importe_total: 85000
                  servicios:
                    - servicio_id: 1
                      descripcion: "Animación"
                      importe: 15000
        '400':
          description: Error de validación (campos obligatorios o estructura de servicios)
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos para crear reservas
        '500':
          description: Error interno del servidor
  /api/v1/reservas/{reserva_id}:
    parameters:
      - name: reserva_id
        in: path
        required: true
        schema:
          type: integer
    get:
      summary: Obtener reserva por ID
      description: Disponible para roles 1, 2 y 3.
      tags: [reservas]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Reserva encontrada
          content:
            application/json:
              schema:
                type: object
                properties:
                  estado:
                    type: boolean
                  datos:
                    $ref: '#/components/schemas/ReservaConServicios'
              example:
                estado: true
                datos:
                  reserva_id: 18
                  fecha_reserva: "2025-01-15"
                  tematica: "Mario Bros"
                  servicios:
                    - servicio_id: 1
                      descripcion: "Animación"
                      importe: 15000
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos para consultar
        '404':
          description: Reserva no encontrada
        '500':
          description: Error interno del servidor
    put:
      summary: Modificar reserva
      description: Solo administradores (rol 1). Valida fecha y turno; el resto de campos es opcional.
      tags: [reservas]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReservaUpdate'
            example:
              fecha_reserva: "2025-01-20"
              turno_id: 2
              tematica: "Superhéroes"
              activo: 1
      responses:
        '200':
          description: Reserva actualizada
          content:
            application/json:
              schema:
                type: object
                properties:
                  estado:
                    type: boolean
                  mensaje:
                    type: string
                  reserva:
                    $ref: '#/components/schemas/ReservaConServicios'
        '400':
          description: Error de validación
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos para modificar
        '404':
          description: Reserva no encontrada
        '500':
          description: Error interno del servidor
    delete:
      summary: Eliminar reserva
      description: Marca la reserva como inactiva. Solo administradores (rol 1).
      tags: [reservas]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Reserva eliminada
          content:
            application/json:
              schema:
                type: object
                properties:
                  estado:
                    type: boolean
                  mensaje:
                    type: string
              example:
                estado: true
                mensaje: "Reserva eliminada correctamente"
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos para eliminar
        '404':
          description: Reserva no encontrada
        '500':
          description: Error interno del servidor
  /api/v1/reservas/informe:
    get:
      summary: Generar informe de reservas (PDF o CSV)
      description: Solo administradores (rol 1). Consume el procedimiento almacenado `reporte_reservas_por_mes`.
      tags: [reservas]
      security:
        - bearerAuth: []
      parameters:
        - name: formato
          in: query
          required: true
          schema:
            type: string
            enum: [pdf, csv]
          description: Formato de salida del informe
      responses:
        '200':
          description: Informe generado en el formato solicitado
          content:
            application/pdf:
              schema:
                type: string
                format: binary
            text/csv:
              schema:
                type: string
        '400':
          description: Formato inválido o sin datos para generar el informe
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos para generar informes
        '404':
          description: No hay datos para generar el informe
        '500':
          description: Error interno del servidor
  /api/v1/reservas/reporte-detallado:
    get:
      summary: Reporte detallado de reservas
      description: Solo administradores (rol 1). Devuelve datos crudos provenientes del servicio.
      tags: [reservas]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Reporte detallado en formato JSON
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos para acceder al reporte
        '500':
          description: Error interno del servidor
  /api/v1/reservas/reporte-estadisticas:
    get:
      summary: Estadísticas de reservas
      description: Solo administradores (rol 1). Devuelve métricas agregadas.
      tags: [reservas]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Estadísticas en formato JSON
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos para acceder al reporte
        '500':
          description: Error interno del servidor

components:
  schemas:
    ReservaConServicios:
      type: object
      properties:
        reserva_id:
          type: integer
        fecha_reserva:
          type: string
          format: date
        tematica:
          type: string
        importe_salon:
          type: number
        importe_total:
          type: number
        salon_id:
          type: integer
        salon_titulo:
          type: string
        salon_direccion:
          type: string
        salon_capacidad:
          type: integer
        salon_importe:
          type: number
        turno_id:
          type: integer
        hora_desde:
          type: string
          format: time
        hora_hasta:
          type: string
          format: time
        servicios:
          type: array
          items:
            type: object
            properties:
              servicio_id:
                type: integer
              descripcion:
                type: string
              importe:
                type: number
    ReservaCreate:
      type: object
      required:
        - fecha_reserva
        - salon_id
        - usuario_id
        - turno_id
        - servicios
      properties:
        fecha_reserva:
          type: string
          format: date
        salon_id:
          type: integer
        usuario_id:
          type: integer
        turno_id:
          type: integer
        foto_cumpleaniero:
          type: string
        tematica:
          type: string
        importe_salon:
          type: number
        importe_total:
          type: number
        servicios:
          type: array
          items:
            type: object
            required:
              - servicio_id
              - importe
            properties:
              servicio_id:
                type: integer
              importe:
                type: number
    ReservaUpdate:
      type: object
      required:
        - fecha_reserva
        - turno_id
      properties:
        fecha_reserva:
          type: string
          format: date
        salon_id:
          type: integer
        usuario_id:
          type: integer
        turno_id:
          type: integer
        tematica:
          type: string
        foto_cumpleaniero:
          type: string
        importe_salon:
          type: number
        importe_total:
          type: number
        activo:
          type: integer

