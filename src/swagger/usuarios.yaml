paths:
  /api/v1/auth/login:
    post:
      summary: Iniciar sesión
      description: Valida credenciales con Passport Local y devuelve un JWT válido por una hora.
      tags: [auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              nombre_usuario: admin@correo.com
              contrasenia: 123456
      responses:
        '200':
          description: Login exitoso
          content:
            application/json:
              schema:
                type: object
                properties:
                  estado:
                    type: boolean
                  token:
                    type: string
        '401':
          description: Credenciales inválidas
        '500':
          description: Error interno del servidor

  /api/v1/usuarios/registro:
    post:
      summary: Registrar cliente (público)
      description: Crea un usuario con `tipo_usuario = 3`. No requiere autenticación.
      tags: [usuarios]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UsuarioRegistroPublico'
            example:
              nombre: Laura
              apellido: Díaz
              nombre_usuario: laura@example.com
              contrasenia: 123456
              celular: 1122334455
      responses:
        '201':
          description: Cliente registrado
          content:
            application/json:
              schema:
                type: object
                properties:
                  estado:
                    type: boolean
                  mensaje:
                    type: string
                  usuario:
                    $ref: '#/components/schemas/Usuario'
        '400':
          description: Error de validación
        '409':
          description: El correo ya está registrado
        '500':
          description: Error interno del servidor

  /api/v1/usuarios:
    get:
      summary: Listado de usuarios
      description: Solo administradores (rol 1).
      tags: [usuarios]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Usuarios activos
          content:
            application/json:
              schema:
                type: object
                properties:
                  estado:
                    type: boolean
                  datos:
                    type: array
                    items:
                      $ref: '#/components/schemas/Usuario'
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos
        '500':
          description: Error interno del servidor
    post:
      summary: Crear usuario (administración)
      description: Solo rol 1. Permite definir tipo de usuario 1, 2 o 3.
      tags: [usuarios]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UsuarioCreate'
            example:
              nombre: Ana
              apellido: López
              nombre_usuario: ana@example.com
              tipo_usuario: 2
              contrasenia: 123456
              celular: 1166778899
      responses:
        '200':
          description: Usuario creado
          content:
            application/json:
              schema:
                type: object
                properties:
                  estado:
                    type: boolean
                  mensaje:
                    type: string
                  usuario:
                    $ref: '#/components/schemas/Usuario'
        '400':
          description: Error de validación
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos
        '500':
          description: Error interno del servidor

  /api/v1/usuarios/{usuario_id}:
    parameters:
      - name: usuario_id
        in: path
        required: true
        schema:
          type: integer
    get:
      summary: Obtener usuario por ID
      description: Solo rol 1.
      tags: [usuarios]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Usuario encontrado
          content:
            application/json:
              schema:
                type: object
                properties:
                  estado:
                    type: boolean
                  usuario:
                    $ref: '#/components/schemas/UsuarioDetalle'
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos
        '404':
          description: Usuario no encontrado
        '500':
          description: Error interno del servidor
    put:
      summary: Modificar usuario
      description: Solo rol 1. Valida nombre, apellido, correo, tipo_usuario (1-3) y celular numérico.
      tags: [usuarios]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UsuarioUpdateAdmin'
      responses:
        '200':
          description: Usuario actualizado
          content:
            application/json:
              schema:
                type: object
                properties:
                  estado:
                    type: boolean
                  mensaje:
                    type: string
                  usuario:
                    $ref: '#/components/schemas/Usuario'
        '400':
          description: Error de validación o campos no permitidos
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos
        '404':
          description: Usuario no encontrado
        '500':
          description: Error interno del servidor
    delete:
      summary: Eliminar usuario (baja lógica)
      description: Solo rol 1.
      tags: [usuarios]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Usuario eliminado
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos
        '404':
          description: Usuario no encontrado
        '500':
          description: Error interno del servidor

  /api/v1/usuarios/clientes:
    get:
      summary: Listado de clientes
      description: Solo rol 2 (empleado) según el middleware de autorización.
      tags: [usuarios]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Clientes activos (tipo_usuario = 3)
          content:
            application/json:
              schema:
                type: object
                properties:
                  estado:
                    type: boolean
                  datos:
                    type: array
                    items:
                      $ref: '#/components/schemas/Usuario'
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos
        '500':
          description: Error interno del servidor

  /api/v1/usuarios/fotousuario:
    put:
      summary: Actualizar datos del usuario con carga de foto
      description: Disponible para rol 3. Recibe un archivo `foto` y campos opcionales del perfil. (Actualmente guarda el archivo en `./src/publico`).
      tags: [usuarios]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                foto:
                  type: string
                  format: binary
                nombre:
                  type: string
                apellido:
                  type: string
                nombre_usuario:
                  type: string
                contrasenia:
                  type: string
                tipo_usuario:
                  type: integer
                celular:
                  type: string
      responses:
        '200':
          description: Usuario actualizado (cuando la modificación es exitosa)
        '400':
          description: No se enviaron campos válidos
        '401':
          description: Token ausente o inválido
        '403':
          description: Rol sin permisos
        '404':
          description: Usuario no encontrado para modificar
        '500':
          description: Error interno del servidor

components:
  schemas:
    LoginRequest:
      type: object
      required:
        - nombre_usuario
        - contrasenia
      properties:
        nombre_usuario:
          type: string
          format: email
        contrasenia:
          type: string
    Usuario:
      type: object
      properties:
        usuario_id:
          type: integer
        nombre:
          type: string
        apellido:
          type: string
        nombre_usuario:
          type: string
        tipo_usuario:
          type: integer
    UsuarioDetalle:
      type: object
      properties:
        usuario:
          type: string
          description: Nombre completo
        tipo_usuario:
          type: integer
        usuario_id:
          type: integer
        nombre_usuario:
          type: string
    UsuarioCreate:
      type: object
      required:
        - nombre
        - apellido
        - nombre_usuario
        - tipo_usuario
        - contrasenia
        - celular
      properties:
        nombre:
          type: string
        apellido:
          type: string
        nombre_usuario:
          type: string
          format: email
        tipo_usuario:
          type: integer
          minimum: 1
          maximum: 3
        contrasenia:
          type: string
        celular:
          type: string
    UsuarioUpdateAdmin:
      allOf:
        - $ref: '#/components/schemas/UsuarioCreate'
      required:
        - nombre
        - apellido
        - nombre_usuario
        - tipo_usuario
        - celular
    UsuarioRegistroPublico:
      type: object
      required:
        - nombre
        - apellido
        - nombre_usuario
        - contrasenia
        - celular
      properties:
        nombre:
          type: string
        apellido:
          type: string
        nombre_usuario:
          type: string
          format: email
        contrasenia:
          type: string
        celular:
          type: string